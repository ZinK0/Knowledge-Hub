<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile</title>
    <!-- Bootstrap Link -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons  -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      /* Custom CSS here */
      /* General layout */
      .card-text {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        margin-bottom: 10px;
      }

      .profile-page {
        padding: 0;
      }

      .sidebar {
        position: relative;
        min-height: 100vh;
        border-right: 1px solid #ccc;
      }

      .profile-img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 50%;
      }

      .nav-link {
        font-size: 1.1em;
        color: #333;
      }

      .nav-link.active {
        background-color: #007bff;
        color: white;
      }

      .logout-btn {
        padding: 20px;
      }

      .content-area {
        padding: 40px;
      }

      .content-section {
        /* Add any additional styling for content sections */
      }

      @media (max-width: 768px) {
        .sidebar {
          min-height: auto;
        }

        .logout-btn {
          position: static;
          padding: 20px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container-fluid profile-page">
      <div class="row w-100">
        <!-- Left Navigation Section -->
        <div class="col-lg-3 col-md-4 bg-light sidebar">
          <div class="text-center py-4 d-flex align-items-center">
            <img
              id="profile-img"
              src=""
              alt="Profile Picture"
              class="profile-img img-thumbnail mx-4"
            />
            <h2 id="profile-name" class="mt-2">Profile Name</h2>
          </div>
          <hr />
          <nav class="nav flex-column">
            <a
              class="nav-link active"
              href="#"
              onclick="showSection(event, 'updateProfile')"
              ><i class="bi bi-person"></i> Update Profile</a
            >
            <a class="nav-link" href="#" onclick="showSection(event, 'posts')"
              ><i class="bi bi-file-earmark-text"></i> Posts</a
            >
          </nav>
          <div class="logout-btn position-absolute bottom-0 w-100">
            <button class="btn btn-danger btn-block w-100">
              <i class="bi bi-box-arrow-right"></i> Logout
            </button>
          </div>
        </div>

        <!-- Right Content Section -->
        <div class="col-lg-9 col-md-8 content-area">
          <!-- Update Profile Section -->
          <div id="updateProfile" class="content-section">
            <h3>Update Profile</h3>
            <form id="profileForm">
              <div class="mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="updateName"
                  placeholder="Update Name"
                />
              </div>
              <div class="mb-3">
                <input
                  type="password"
                  class="form-control"
                  id="updatePassword"
                  placeholder="Update Password"
                />
              </div>
              <button
                type="button"
                class="btn btn-primary"
                onclick="updateProfile()"
              >
                Update
              </button>
            </form>
          </div>

          <!-- Posts Section -->
          <div id="posts" class="content-section" style="display: none">
            <h3>Your Posts</h3>
            <!-- <ul class="list-group">
              <li
                class="list-group-item d-flex justify-content-between align-items-center"
              >
                Post Title 1
                <span>
                  <button class="btn btn-warning btn-sm me-2">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-danger btn-sm">
                    <i class="bi bi-trash"></i>
                  </button>
                </span>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center"
              >
                Post Title 2
                <span>
                  <button class="btn btn-warning btn-sm me-2">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-danger btn-sm">
                    <i class="bi bi-trash"></i>
                  </button>
                </span>
              </li>
              
            </ul> -->
            <table class="table">
              <thead>
                <tr>
                  <th class="col-lg-6">Posts</th>
                  <th class="col-lg-3">Date Modified</th>
                  <th class="col-lg-3">Action</th>
                </tr>
              </thead>
              <tbody class="table-group-divider">
                <!-- Posts will be injected by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery Script CDN  -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>

    <!-- <script src="./assets/js/script.js"></script> -->

    <script>
      let loginUserAvatar;
      let loginState = JSON.parse(localStorage.getItem("loginState"));
      console.log(loginState);
      let users = JSON.parse(localStorage.getItem("users"));
      console.log(users);

      if (loginState) {
        let avatarId = loginState.loggedUserID;
        console.log(avatarId);

        let loggedUser = users.find((user) => user.userID === avatarId);
        console.log(loggedUser);
        // loginUserAvatar = loggedUser.avatar;
        $("#profile-img").attr("src", loggedUser.avatar);
        $("#profile-name").text(loggedUser.userName);

        $("#updateName").val(loggedUser.email);
        $("#updatePassword").val(loggedUser.password);
      }

      // let profileImg =
      // JavaScript for toggling content sections
      function showSection(event, sectionId) {
        // Prevent default link behavior
        event.preventDefault();

        // Hide all content sections
        const sections = document.querySelectorAll(".content-section");
        sections.forEach((section) => {
          section.style.display = "none";
        });

        // Remove active class from all nav links
        const navLinks = document.querySelectorAll(".nav-link");
        navLinks.forEach((link) => {
          link.classList.remove("active");
        });

        // Show the selected section
        document.getElementById(sectionId).style.display = "block";

        // Add active class to the clicked nav link
        event.currentTarget.classList.add("active");
      }

      // JavaScript for Profile Update
      function updateProfile() {
        const name = document.getElementById("updateName").value;
        const password = document.getElementById("updatePassword").value;
        alert(`Profile updated!\nName: ${name}\nPassword: ${password}`);

        const updatedUsers = users.map((user) => {
          if (user.userID === loginState.loggedUserID) {
            return {
              ...user,
              email: name,
              password: password,
            };
          }
          return user;
        });
        console.log(updatedUsers);

        localStorage.setItem("users", JSON.stringify(updatedUsers));

        location.reload();
      }
    </script>
    <script src="./assets/js/profile.js"></script>
  </body>
</html>
